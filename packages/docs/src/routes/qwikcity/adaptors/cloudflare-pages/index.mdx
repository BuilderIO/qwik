---
title: Qwik City - Cloudflare Pages Adaptor and Middleware
contributors:
  - adamdbradley
---

# Cloudflare Pages Adaptor

Qwik City Cloudflare Pages adaptor allows you to connect Qwik City to [Cloudflare Pages](https://pages.cloudflare.com/).

## Installation

To integrate the `cloudflare-pages` adaptor, use the `add` command:

```shell
npm run qwik add cloudflare-pages
```

The adaptor will add a new `vite.config.ts` within the `adaptors/` directory, and a new entry file will be created, such as:

```
└── adaptors/
    └── cloudflare-pages/
        └── vite.config.ts
└── src/
    └── entry.cloudflare-pages.tsx
```

Additionally, within the `package.json`, the `build.server` script will be updated with the Cloudflare build.

## Production build

To build the application for production, use the `build` command, this command will automatically run `npm run build.server` and `npm run build.client`:

```shell
npm run build
```

[Read the full guide here](https://github.com/BuilderIO/qwik/tree/main/starters/adaptors/cloudflare-pages/README.md)

## Local development deployment

To deploy the application for local development:

```shell
npm run build
npm run serve
```

## Deploy to Cloudflare Pages

After installing the integration using `npm run qwik add`. The project is ready to be deployed to Cloudflare Pages. However, you will need to create a git repository and push the code to it.

Please refer to the [Cloudflare Pages docs](https://developers.cloudflare.com/pages/framework-guides/deploy-a-qwik-site/) for more information on how to deploy your site.

Notice that you might need a [Cloudflare account](https://dash.cloudflare.com/sign-up?lang=en-US) in order to complete this step!

## Advanced

### Cloudflare Pages Entry Middleware

When the `cloudflare-pages` adaptor is added, a new entry file will be created at `src/entry.cloudflare-pages.tsx`. Below is an example of using the built-in middleware within the entry file.

```tsx
// src/entry.cloudflare-pages.tsx
import { createQwikCity } from '@builder.io/qwik-city/middleware/cloudflare-pages';
import qwikCityPlan from '@qwik-city-plan';
import render from './entry.ssr';

const onRequest = createQwikCity({ render, qwikCityPlan });

export { onRequest };
```

The compiled middleware will be built in the `server/` directory and can then be used anywhere in the cloudflare pages `/functions` directory.

```tsx
// export the compiled middleware where cloudflare pages can find it.
// for example use /functions/[[path]].ts or /functions/_middleware.ts
// to have qwik city handle all requests.
export { onRequest } from '../server/entry.cloudflare-pages';
```

- [Cloudflare Pages Middleware Source](https://github.com/BuilderIO/qwik/tree/main/packages/qwik-city/middleware/cloudflare-pages/index.ts)
- [Cloudflare Pages Functions](https://developers.cloudflare.com/pages/platform/functions/)
- [Function Invocation Route Config](https://developers.cloudflare.com/pages/platform/functions/function-invocation-routes/)

### Context

You may access Cloudflare Page's environment variables in the endpoint method's `platform` param:

```javascript
export const onRequest = async ({ platform }) => {
  const secret = platform.env['SUPER_SECRET_TOKEN'];
};
```

Additionally, you may import the `RequestHandlerCloudflarePages` type to have have type completions in your editor.

```tsx
import { type RequestHandlerCloudflarePages } from '@builder.io/qwik-city/middleware/cloudflare-pages';

export const onGet: RequestHandlerCloudflarePages = ({ platform }) => {
  //...
};
```
